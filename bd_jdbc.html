

<!DOCTYPE html>
<html class="writer-html5" lang="ca" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>JDBC &mdash; Introducció a la programació amb Java 2020-21 documentació</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/moistyle.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script src="_static/translations.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="author" title="Quant a aquests documents" href="about.html" />
    <link rel="index" title="Índex" href="genindex.html" />
    <link rel="search" title="Cerca" href="search.html" />
    <link rel="next" title="El Zoo persistent" href="bd_consultes.html" />
    <link rel="prev" title="SGBD" href="bd_sgbd.html" />
     
    <script class="googleanalytics" src="_static/moiscripts.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> Introducció a la programació amb Java
          

          
            
            <img src="_static/logoprg.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                2020-21
              </div>
            
          

          

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="primeres_passes.html">Primeres passes</a></li>
<li class="toctree-l1"><a class="reference internal" href="basics.html">Elements bàsics de la programació</a></li>
<li class="toctree-l1"><a class="reference internal" href="moduls.html">Mòduls</a></li>
<li class="toctree-l1"><a class="reference internal" href="fitxers.html">Fitxers</a></li>
<li class="toctree-l1"><a class="reference internal" href="poo.html">Programació Orientada a Objectes</a></li>
<li class="toctree-l1"><a class="reference internal" href="biblioteques.html">Biblioteques</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="bd.html">Persistència amb bases de dades</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="bd_modelrelacional_i_poo.html">POO i Model Relacional</a></li>
<li class="toctree-l2"><a class="reference internal" href="bd_sgbd.html">SGBD</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">JDBC</a></li>
<li class="toctree-l2"><a class="reference internal" href="bd_consultes.html">El Zoo persistent</a></li>
<li class="toctree-l2"><a class="reference internal" href="bd_exercicis.html">Exercicis de persistència</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="apendix.html">Apèndix</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Introducció a la programació amb Java</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="bd.html">Persistència amb bases de dades</a> &raquo;</li>
        
      <li>JDBC</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
    
           <div itemprop="articleBody">
            
  <div class="section" id="jdbc">
<h1>JDBC<a class="headerlink" href="#jdbc" title="Link permanent a aquest títol">¶</a></h1>
<p>Ara que ja tenim el nostre SGBD, ens cal quelcom que faci de pont entre aquest
i els nostres programes.</p>
<p>Al codi que ens facilita la comunicació entre el nostre programa i altres
elements externs, sigui una base de dades sigui un dispositiu físic, el
solem conèixer com a <em>controlador</em> o <em>driver</em> .</p>
<p>Cada dispositiu o component amb que vulguem interaccionar, haurà de
disposar del seu propi controlador pel llenguatge de programació amb el
que estiguem fent el nostre programa.</p>
<p>Java ens ofereix un conjunt de classes per poder utilitzar aquests
controladors d’una manera unificada. Aquestes classes les agrupa en un
paquet anomenat <em>JDBC</em>.</p>
<div class="section" id="que-es-jdbc">
<h2>Què és JDBC<a class="headerlink" href="#que-es-jdbc" title="Link permanent a aquest títol">¶</a></h2>
<p>Segons la definició que apareix a la documentació oficial de Java per
<a class="reference external" href="https://docs.oracle.com/en/java/javase/11/docs/api/java.sql/java/sql/package-summary.html">JDBC</a>,
ens ofereix la API (Interfície de programació d’aplicacions o <em>Application
Programming Interface</em>) per a accedir i processar dades emmagatzemades en
una font de dades, normalment una base de dades relacional, fent servir el
llenguatge de programació Java. La API inclou un entorn en el que es poden
instal·lar dinàmicament diferents controladors per a accedir a les
diferents fonts de dades.</p>
<p>Malgrat JDBC està orientat principalment a passar comandes SQL a una base
de dades, també ofereix mecanismes per llegir i escriure dades des de i
cap a qualsevol font de dades en format tabular com ara fulls de càlcul o
fitxers csv.</p>
<p>Amb JDBC, per tant, disposem d’un conjunt d”<em>interfaces</em> i alguna classe
completa que ens permetrà comunicar-nos amb el SGBD (entre altres fonts de
dades)</p>
<p>Per si sol, no podrem fer gaire cosa, fins que disposem d’una
implementació concreta i adequada pel nostre SGBD. Aquesta implementació
és el <em>controlador</em> o <em>driver</em>.</p>
<p>Si el <em>driver</em> implementa correctament la
interfície, el codi que desenvolupem fent-la servir, hauria de funcionar
(sense comptar les sentències SQL) per altres fonts de dades que
implementin el JDBC.</p>
<p><img alt="exerciseiconO__" src="_images/exerciseiconO__.png" /> <a class="reference internal" href="exercici_06_01_jdbc.html"><span class="doc"> Exercici 06_01. A veure si ho he entès bé</span></a></p>
</div>
<div class="section" id="installacio-del-controlador">
<h2>Instal·lació del controlador<a class="headerlink" href="#installacio-del-controlador" title="Link permanent a aquest títol">¶</a></h2>
<p>Com que el nostre SGBD escollit és el SQLite, ens caldrà obtenir una còpia
adequada d’aquest controlador.</p>
<p>Al teu repositori hi trobaràs una utilitat d’instal·lació i configuració
perquè no t’hagis de preocupar.</p>
<p>Simplement executa:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> bash <span class="nv">$INTROPRGDIR</span>/lib/install_sqlite_jdbc.sh
</pre></div>
</div>
<p>Caldrà que et surtin tots els avisos indicant que ha estat correcte.
Altrament parla amb mi.</p>
<p>Si ho vols fer manualment, les passes són:</p>
<ol class="arabic">
<li><p>Descarregat el controlador</p>
<p>Un dels llocs més segurs per descarregar-te el controlador és el
repositori de <a class="reference external" href="https://mvnrepository.com/">Maven</a>. En concret, trobaràs
les diferents versions disponibles <a class="reference external" href="https://mvnrepository.com/artifact/org.xerial/sqlite-jdbc">aquí</a></p>
</li>
<li><p>Configura la variable <code class="docutils literal notranslate"><span class="pre">CLASSPATH</span></code> perquè inclogui el camí al
controlador.</p></li>
<li><p>Comprova que el controlador estigui disponible</p>
<p>Una manera és executar el següent codi que intenta trobar el
controlador. Si tot ha anat bé, finalitzarà sense generar cap error.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestSQLite</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">java</span><span class="p">.</span><span class="na">sql</span><span class="p">.</span><span class="na">SQLException</span> <span class="p">{</span>
        <span class="n">java</span><span class="p">.</span><span class="na">sql</span><span class="p">.</span><span class="na">DriverManager</span><span class="p">.</span><span class="na">getDriver</span><span class="p">(</span><span class="s">&quot;jdbc:sqlite:test.bd&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>Si no t’ha funcionat i no trobes manera de resoldre el problema, fes
servir el guió d’instal·lació.</p></li>
</ol>
</div>
<div class="section" id="connexio">
<h2>Connexió<a class="headerlink" href="#connexio" title="Link permanent a aquest títol">¶</a></h2>
<p>Connectem-nos a una base de dades:</p>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.sql.DriverManager</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.sql.Connection</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.sql.SQLException</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UsaSQLite</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">SQLException</span> <span class="p">{</span>
        <span class="n">Connection</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">DriverManager</span><span class="p">.</span><span class="na">getConnection</span><span class="p">(</span><span class="s">&quot;jdbc:sqlite:test.bd&quot;</span><span class="p">);</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Connectat!&quot;</span><span class="p">);</span>
        <span class="n">conn</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Si tot ha anat bé, ens sortirà el missatge de <code class="docutils literal notranslate"><span class="pre">&quot;Connectat!&quot;</span></code> i ens
apareixerà un nou fitxer a la carpeta actual anomenat <code class="docutils literal notranslate"><span class="pre">test.bd</span></code>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> java UsaSQLite
<span class="go">Connectat!</span>
<span class="gp">$</span> ls
<span class="go">UsaSQLite.class</span>
<span class="go">UsaSQLite.java</span>
<span class="go">test.bd</span>
</pre></div>
</div>
<p>El fitxer <code class="docutils literal notranslate"><span class="pre">test.bd</span></code> conté les dades del la base de dades a la que acabes
d’intentar conectar-te. Bé, ara mateix no tindrà gaire dades doncs encara
no li hem afegit res. De fet, si mires la seva mida és 0 bytes!</p>
</div>
<div class="section" id="la-cadena-de-connexio">
<h2>La cadena de connexió<a class="headerlink" href="#la-cadena-de-connexio" title="Link permanent a aquest títol">¶</a></h2>
<p>Tornem a observar el codi anterior:</p>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.sql.DriverManager</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.sql.Connection</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.sql.SQLException</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UsaSQLite</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">SQLException</span> <span class="p">{</span>
<span class="hll">        <span class="n">Connection</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">DriverManager</span><span class="p">.</span><span class="na">getConnection</span><span class="p">(</span><span class="s">&quot;jdbc:sqlite:test.bd&quot;</span><span class="p">);</span>
</span>        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Connectat!&quot;</span><span class="p">);</span>
        <span class="n">conn</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Al String <code class="docutils literal notranslate"><span class="pre">&quot;jdbc:sqlite:test.bd&quot;</span></code> se’l coneix com a <em>cadena de
connexió</em>. Ha de contenir la informació necessària per que es pugui
identificar el controlador i la base de dades.</p>
<p>Cada SGBD té els seus requeriments per especificar la cadena de connexió.
En el cas de SQLite és especialment senzilla doncs no considera ni el
<em>host</em> on es troba la base de dades, ni l’usuari/password per accedir-hi.</p>
<p>Una cadena de connexió més completa, com per exemple per a PostgreSQL,
podria ser:</p>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">usuari</span>   <span class="o">=</span> <span class="s">&quot;usuaribd&quot;</span><span class="p">;</span>
<span class="n">String</span> <span class="n">password</span> <span class="o">=</span> <span class="s">&quot;passwordsupersecret&quot;</span><span class="p">;</span>
<span class="n">String</span> <span class="n">host</span>     <span class="o">=</span> <span class="s">&quot;192.168.33.10&quot;</span><span class="p">;</span>
<span class="n">String</span> <span class="n">bd</span>       <span class="o">=</span> <span class="s">&quot;testbd&quot;</span><span class="p">;</span>         <span class="c1">// el nom de la base de dades</span>

<span class="n">String</span> <span class="n">cadenaConnexio</span>
    <span class="o">=</span> <span class="s">&quot;jdbc:postgresql://&quot;</span> <span class="o">+</span> <span class="n">host</span>
    <span class="o">+</span> <span class="s">&quot;/&quot;</span>                  <span class="o">+</span> <span class="n">bd</span>
    <span class="o">+</span> <span class="s">&quot;?user=&quot;</span>             <span class="o">+</span> <span class="n">usuari</span>
    <span class="o">+</span> <span class="s">&quot;&amp;password=&quot;</span>         <span class="o">+</span> <span class="n">password</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<p>Si tens un altre SGBD instal·lat a la teva màquina, potser et farà gràcia
comprovar com funciona en amb ell el codi que desenvoluparàs en aquest
tema.</p>
</div>
<div class="section" id="excepcions">
<h2>Excepcions<a class="headerlink" href="#excepcions" title="Link permanent a aquest títol">¶</a></h2>
<p>Normalment, però, voldrem gestionar una mica les excepcions que es puguin
produir. Una versió del codi força més sòlida seria:</p>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.sql.DriverManager</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.sql.Connection</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.sql.SQLException</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UsaSQLite</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span> <span class="n">String</span> <span class="n">args</span><span class="o">[]</span> <span class="p">)</span> <span class="p">{</span>
        <span class="kd">final</span> <span class="n">String</span> <span class="n">nom_bd</span> <span class="o">=</span> <span class="s">&quot;test.bd&quot;</span><span class="p">;</span>  <span class="c1">// nom de la base de dades a la que intentarem connectar</span>
        <span class="n">Connection</span> <span class="n">conn</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="n">conn</span> <span class="o">=</span> <span class="n">DriverManager</span><span class="p">.</span><span class="na">getConnection</span><span class="p">(</span><span class="s">&quot;jdbc:sqlite:&quot;</span> <span class="o">+</span> <span class="n">nom_bd</span><span class="p">);</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Connectat amb la base de dades &quot;</span> <span class="o">+</span> <span class="n">nom_bd</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">SQLException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;No es pot connectar a la base de dades &quot;</span> <span class="o">+</span> <span class="n">nom_bd</span><span class="p">);</span>
            <span class="n">System</span><span class="p">.</span><span class="na">err</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getClass</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;: &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span>
        <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">conn</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">try</span> <span class="p">{</span>
                    <span class="n">conn</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
                <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">SQLException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;No es pot tancar la connexió amb la base de dades &quot;</span> <span class="o">+</span> <span class="n">nom_bd</span><span class="p">);</span>
                    <span class="n">System</span><span class="p">.</span><span class="na">err</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getClass</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;: &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Com pots veure, el codi considera la possibilitat de que no sigui possible
connectar-se a la base de dades i, fins i tot en el cas que hi hagi
problemes, intentarà tancar la connexió en cas que aquesta estigui encara
oberta.</p>
</div>
</div>


           </div>
           
          </div>
    <div class="googleanalytics">
    <div id="cookiesbox">
        Aquest lloc web utilitza galetes (<i>cookies</i>) per a analitzar el seu ús
        amb les eines que ofereix <a href="https://www.google.com/analytics">Google Analytics</a>.
        En continuar navegant-hi, estàs acceptant-ho.
        <br/>
        <a class="btn btn-neutral" onclick="setUserAcceptsCookies();">
            Tancar
            <span class="fa fa-window-close"></span>
        </a>
    </div>
    <script>setCookiesboxVisibility();</script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-41103782-2', 'auto');
      ga('send', 'pageview');
    </script>
</div>


          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="bd_consultes.html" class="btn btn-neutral float-right" title="El Zoo persistent" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="bd_sgbd.html" class="btn btn-neutral float-left" title="SGBD" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020-2021 Moisès Gómez Girón

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>